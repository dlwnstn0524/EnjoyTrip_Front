<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>enjoy_trip</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css"
    />
  </head>
  <style>
    .wrap {position: absolute;left: 0;bottom: 40px;width: 288px;height: 132px;margin-left: -144px;text-align: left;overflow: hidden;font-size: 12px;font-family: 'Malgun Gothic', dotum, '돋움', sans-serif;line-height: 1.5;}
    .wrap * {padding: 0;margin: 0;}
    .wrap .info {width: 286px;height: 120px;border-radius: 5px;border-bottom: 2px solid #ccc;border-right: 1px solid #ccc;overflow: hidden;background: #fff;}
    .wrap .info:nth-child(1) {border: 0;box-shadow: 0px 1px 2px #888;}
    .info .title {padding: 5px 0 0 10px;height: 30px;background: #eee;border-bottom: 1px solid #ddd;font-size: 18px;font-weight: bold;}
    .info .close {position: absolute;top: 10px;right: 10px;color: #888;width: 17px;height: 17px;background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png');}
    .info .close:hover {cursor: pointer;}
    .info .body {display: inline; position: relative;overflow: hidden;}
    .info .desc {position: relative;margin: 13px 0 0 90px;height: 75px;}
    .desc .ellipsis {overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}
    .desc .jibun {font-size: 11px;color: #888;margin-top: -2px;}
    .info .img {position: absolute;top: 6px;left: 5px;width: 73px;height: 71px;border: 1px solid #ddd;color: #888;overflow: hidden;}
    .info:after {content: '';position: absolute;margin-left: -12px;left: 50%;bottom: 0;width: 22px;height: 12px;background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white.png')}
    .info .link {color: #5085BB;}
  </style>
  <script src="assets/js/commponent.js"></script>
  <body>
    <div class="container">
      <div id="header"></div>
      <form class="d-flex col" role="search" onsubmit="searchPlaces(); return false;">
        <div class="col" style="margin-top:100px;">
            <div class="row justify-content-center">
                <div class="col-md-3 text-center">
                    <select id="search-area" class="form-select mb-3" aria-label="Default select example">
                        <option value="0" selected>검색 할 지역 선택</option>
                    </select>
                </div>
                <div class="col-md-3 text-center">
                    <select id="search-content-id" class="form-select mb-3" aria-label="Default select example">
                        <option value="0" selected>관광지 유형</option>
                        <option value="12">관광지</option>
                        <option value="14">문화시설</option>
                        <option value="15">축제공연행사</option>
                        <option value="25">여행코스</option>
                        <option value="28">레포츠</option>
                        <option value="32">숙박</option>
                        <option value="38">쇼핑</option>
                        <option value="39">음식점</option>
                    </select>
                </div>
                <div class="col-md-3 text-center">
                        <input id="search-keyword" class="form-control" type="search" placeholder="검색어" aria-label="검색어" value="서울" />
                        <button class="btn btn-primary btn-sm ms-md-3" name="name1" type="submit" style="white-space: nowrap;">검색</button> <!-- ms-md-2 클래스를 추가하여 중간 및 큰 화면 크기에서 왼쪽 마진을 추가 -->
                </div>
            </div>
              <div class="col" id="map" style="height : 600px"></div>
      </div>
    </form>
    </div>
  </body>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=d7653085a7d54c6d8dbbdb60e5fb00ef&libraries=services,clusterer,drawing"></script>
<script src="https://developers.kakao.com/sdk/js/kakao.js"></script><!-- 관광지 공유 api -->
<script>
    // index page 로딩 후 전국의 시도 설정.
let serviceKey = "98bjcTT737wV9WBAYZJCG44LYmmdDeoYCYochcob51sm%2BEj%2FzxuTjjGdOI37R2tJOK0JEHgh4%2Fxeg4f2YYCNCw%3D%3D";
let areaUrl =
"https://apis.data.go.kr/B551011/KorService1/areaCode1?serviceKey=" +
serviceKey +
"&numOfRows=20&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json";
console.log(areaUrl);
fetch(areaUrl, { method: "GET" })
.then((response) => response.json())
.then((data) => makeOption(data));

function makeOption(data) {
console.log(data);
let areas = data.response.body.items.item;
let sel = document.getElementById("search-area");
console.log(sel);
areas.forEach((area) => {
let opt = document.createElement("option");
opt.setAttribute("value", area.code);
opt.appendChild(document.createTextNode(area.name));

sel.appendChild(opt);
});
}

</script>

<script>
// 마커를 담을 배열입니다
var markers = [];
var overlays = [];

var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
    mapOption = {
    	center: new kakao.maps.LatLng(37.566535, 126.9779692), // 지도의 중심좌표
        level: 9 // 지도의 확대 레벨
    };  
// 지도를 생성합니다    
var map = new kakao.maps.Map(mapContainer, mapOption); 

// 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
var mapTypeControl = new kakao.maps.MapTypeControl();

// 지도에 컨트롤을 추가해야 지도위에 표시됩니다
// kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

// 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
var zoomControl = new kakao.maps.ZoomControl();
map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

// 장소 검색 객체를 생성합니다
var ps = new kakao.maps.services.Places();  
// 키워드로 장소를 검색합니다
searchPlaces();
// 키워드 검색을 요청하는 함수입니다
function searchPlaces() {
	
    var keyword = document.getElementById('search-keyword').value;
	
    document.addEventListener('DOMContentLoaded', function() {
    // 검색결과 유효성 검사
    var button = document.querySelector('button[name="name1"]');
        button.addEventListener('click', function() {
          let searchUrl = `https://apis.data.go.kr/B551011/KorService1/searchKeyword1?serviceKey=${serviceKey}&numOfRows=10&pageNo=1&MobileOS=ETC&MobileApp=AppTest&_type=json&listYN=Y&arrange=A`;
            // 검색어 가져오기
            var keyword = document.getElementById('search-keyword').value;

            // 검색어가 공백이 아닌지 확인
            if (!keyword) {
                alert('입력해주세요!');
                return false;
            }else {
              searchUrl += `&keyword=${keyword}`
            };

            console.log(searchUrl);
            fetch(searchUrl)
                .then((response) => {return response.json();})
                .then((data) => {placesSearchCB(data, null);})
                .catch((error) => {
                    // 오류 발생 시 처리하는 부분
                    console.error('API 요청 오류 발생:', error);
                });

        });
    });
        // 장소검색 객체를 통해 키워드로 장소검색을 요청합니다
    // ps.keywordSearch( keyword, placesSearchCB); 
    
}


var positions = []

// 카카오맵 API의 장소 검색 요청에 대한 콜백 함수입니다. 이 콜백 함수는 사용자가 지정한 조건에 따라 카카오맵에서 장소를 검색한 후 결과를 반환할 때 호출됩니다.
function placesSearchCB(data, status) {
  let trips = data.response.body.items.item;
  displayPlaces(trips);
  console.log(trips);
    if (status === kakao.maps.services.Status.OK) {
        // 정상적으로 검색이 완료됐으면
        // 검색 목록과 마커를 표출합니다
    } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
        alert('검색 결과가 존재하지 않습니다.');
        return;
    } else if (status === kakao.maps.services.Status.ERROR) {
        alert('검색 결과 중 오류가 발생했습니다.');
        return;
    }
    
}
//마커를 생성하고 지도 위에 마커를 표시하는 함수입니다
function addMarker(y,x) {
    var imageSrc = "assets/img/marker.png", // 마커 이미지 url, 스프라이트 이미지를 씁니다
        imageSize = new kakao.maps.Size(80, 80),  // 마커 이미지의 크기
        imgOptions =  {
            spriteSize : new kakao.maps.Size(30, 60), // 스프라이트 이미지의 크기
            spriteOrigin : new kakao.maps.Point(0, 0), // 스프라이트 이미지 중 사용할 영역의 좌상단 좌표
            offset: new kakao.maps.Point(12, 60) // 마커 좌표에 일치시킬 이미지 내에서의 좌표
        },
        markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize, imgOptions),
            marker = new kakao.maps.Marker({
            position: new kakao.maps.LatLng(y, x), // 마커의 위치
            image: markerImage 
        });
    
    marker.setMap(map); // 지도 위에 마커를 표출합니다
    markers.push(marker);  // 배열에 생성된 마커를 추가합니다
    return marker;
}
// 검색 결과 목록과 마커를 표출하는 함수입니다
function displayPlaces(places) {
// kakao.maps.LatLngBounds()는 카카오맵에서 사용되는 경도 및 위도 좌표의 경계를 정의하는 클래스입니다. 
    bounds = new kakao.maps.LatLngBounds();
    // 지도에 표시되고 있는 마커를 제거합니다
    removeMarker();
    
    for ( var i=0; i<places.length; i++ ) {
		positions.push({title:places[i].addr1,latlng_x:places[i].mapx,latlng_y:places[i].mapy});
	}
    
    for (var i=0; i<positions.length; i++){
		var placePosition = new kakao.maps.LatLng(places[i].mapy, places[i].mapx);
        
      displayMarker(places,i);
	    bounds.extend(placePosition);
	}

    // 검색결과 항목들을 검색결과 목록 Element에 추가합니다
    // menuEl.scrollTop = 0;
    // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
    map.setBounds(bounds);
}

//지도에 마커 클릭시 오버레이 출력
function displayMarker(places,i) { 
	marker = addMarker(places[i].mapy,places[i].mapx);
	
    var overlay = new kakao.maps.CustomOverlay({
        position: marker.getPosition()
    });

    var content = document.createElement('div');
    content.classList.add('wrap');
    content.innerHTML =  '<div class="info">' + 
                            '<div class="title">' + places[i].title + '</div>' +
                            '<div class="body">' + 
                                '<div class="img">' + 
                                    '<img src="' + places[i].firstimage + '" width="73" height="70">' + 
                                '</div>' + 
                            '</div>' +
                            '<div class="desc">' + 
                                '<div class="ellipsis">' + places[i].addr1 + '</div>' + 
                                '<div class="jibun ellipsis">' + places[i].addr2 + '</div>' + 
                            '</div>' + 
                            
                        '</div>';

    var closeBtn = document.createElement('button');
    closeBtn.innerHTML = '<i class="fa-solid fa-rectangle-xmark fa-xl" style="font-size:20px;"></i>';
    closeBtn.style.cssText = 'position:absolute; width:20px; height:18px; border:none;background:black;';
    
    closeBtn.onclick = function () {
        overlay.setMap(null);
    };
 
    content.appendChild(closeBtn);
    overlay.setContent(content);
    
    kakao.maps.event.addListener(marker, 'click', function() {
    	
    	removeOverlay();
        overlay.setMap(map);
        
    });
    
    overlays.push(overlay);
    
   	
}
	// 검색결과 목록 또는 마커를 클릭했을 때 호출되는 함수입니다
	// 인포윈도우에 장소명을 표시합니다
	
	
	// 지도 위에 표시되고 있는 마커,오버레이 모두 제거합니다
	function removeMarker() {
	    for ( var i = 0; i < markers.length; i++ ) {
	        markers[i].setMap(null);
	    }   
	    
	    for ( var i = 0; i < overlays.length; i++ ) {
	        overlays[i].setMap(null);
	    }   
	    markers = [];
	    positions = [];
	    overlays = [];
	}
	
	
	//다른 오버레이 클릭시 기존에 열려있던 오버레이 창을 닫음
	function removeOverlay() {
	    for ( var i = 0; i < overlays.length; i++ ) {
	        overlays[i].setMap(null);
	    }   
	}

</script>



</html>